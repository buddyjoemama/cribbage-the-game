/**
 * @license almond 0.3.0 Copyright (c) 2011-2014, The Dojo Foundation All Rights Reserved.
 * Available via the MIT or new BSD license.
 * see: http://github.com/jrburke/almond for details
 */

/* Zepto v1.1.4 - zepto event ajax form ie - zeptojs.com/license */

/*!
 * mustache.js - Logic-less {{mustache}} templates with JavaScript
 * http://github.com/janl/mustache.js
 */

/**
 * @license RequireJS text 2.0.13 Copyright (c) 2010-2014, The Dojo Foundation All Rights Reserved.
 * Available via the MIT or new BSD license.
 * see: http://github.com/requirejs/text for details
 */

var requirejs,require,define;(function(e){function h(e,t){return f.call(e,t)}function p(e,t){var n,r,i,s,o,a,f,l,h,p,d,v=t&&t.split("/"),m=u.map,g=m&&m["*"]||{};if(e&&e.charAt(0)===".")if(t){v=v.slice(0,v.length-1),e=e.split("/"),o=e.length-1,u.nodeIdCompat&&c.test(e[o])&&(e[o]=e[o].replace(c,"")),e=v.concat(e);for(h=0;h<e.length;h+=1){d=e[h];if(d===".")e.splice(h,1),h-=1;else if(d===".."){if(h===1&&(e[2]===".."||e[0]===".."))break;h>0&&(e.splice(h-1,2),h-=2)}}e=e.join("/")}else e.indexOf("./")===0&&(e=e.substring(2));if((v||g)&&m){n=e.split("/");for(h=n.length;h>0;h-=1){r=n.slice(0,h).join("/");if(v)for(p=v.length;p>0;p-=1){i=m[v.slice(0,p).join("/")];if(i){i=i[r];if(i){s=i,a=h;break}}}if(s)break;!f&&g&&g[r]&&(f=g[r],l=h)}!s&&f&&(s=f,a=l),s&&(n.splice(0,a,s),e=n.join("/"))}return e}function d(t,r){return function(){var i=l.call(arguments,0);return typeof i[0]!="string"&&i.length===1&&i.push(null),n.apply(e,i.concat([t,r]))}}function v(e){return function(t){return p(t,e)}}function m(e){return function(t){s[e]=t}}function g(n){if(h(o,n)){var r=o[n];delete o[n],a[n]=!0,t.apply(e,r)}if(!h(s,n)&&!h(a,n))throw new Error("No "+n);return s[n]}function y(e){var t,n=e?e.indexOf("!"):-1;return n>-1&&(t=e.substring(0,n),e=e.substring(n+1,e.length)),[t,e]}function b(e){return function(){return u&&u.config&&u.config[e]||{}}}var t,n,r,i,s={},o={},u={},a={},f=Object.prototype.hasOwnProperty,l=[].slice,c=/\.js$/;r=function(e,t){var n,r=y(e),i=r[0];return e=r[1],i&&(i=p(i,t),n=g(i)),i?n&&n.normalize?e=n.normalize(e,v(t)):e=p(e,t):(e=p(e,t),r=y(e),i=r[0],e=r[1],i&&(n=g(i))),{f:i?i+"!"+e:e,n:e,pr:i,p:n}},i={require:function(e){return d(e)},exports:function(e){var t=s[e];return typeof t!="undefined"?t:s[e]={}},module:function(e){return{id:e,uri:"",exports:s[e],config:b(e)}}},t=function(t,n,u,f){var l,c,p,v,y,b=[],w=typeof u,E;f=f||t;if(w==="undefined"||w==="function"){n=!n.length&&u.length?["require","exports","module"]:n;for(y=0;y<n.length;y+=1){v=r(n[y],f),c=v.f;if(c==="require")b[y]=i.require(t);else if(c==="exports")b[y]=i.exports(t),E=!0;else if(c==="module")l=b[y]=i.module(t);else if(h(s,c)||h(o,c)||h(a,c))b[y]=g(c);else{if(!v.p)throw new Error(t+" missing "+c);v.p.load(v.n,d(f,!0),m(c),{}),b[y]=s[c]}}p=u?u.apply(s[t],b):undefined;if(t)if(l&&l.exports!==e&&l.exports!==s[t])s[t]=l.exports;else if(p!==e||!E)s[t]=p}else t&&(s[t]=u)},requirejs=require=n=function(s,o,a,f,l){if(typeof s=="string")return i[s]?i[s](o):g(r(s,o).f);if(!s.splice){u=s,u.deps&&n(u.deps,u.callback);if(!o)return;o.splice?(s=o,o=a,a=null):s=e}return o=o||function(){},typeof a=="function"&&(a=f,f=l),f?t(e,s,o,a):setTimeout(function(){t(e,s,o,a)},4),n},n.config=function(e){return n(e)},requirejs._defined=s,define=function(e,t,n){t.splice||(n=t,t=[]),!h(s,e)&&!h(o,e)&&(o[e]=[e,t,n])},define.amd={jQuery:!0}})(),define("../bower_components/almond/almond",function(){}),define("modules/PubSub",[],function(){var e={},t=function(t,n){return e[t]||(e[t]=[]),e[t].push({context:this,callback:n}),this},n=function(t,n){if(!e.hasOwnProperty(t))return!1;for(var r=0,i=e[t].length;r<i;r++)if(e[t][r].callback===n)return e[t].splice(r,1),!0;return!1},r=function(t){if(!e[t]||e[t].length===0)return!1;var n=Array.prototype.slice.call(arguments,1);for(var r=0,i=e[t].length;r<i;r++){var s=e[t][r];s.callback.apply(s.context,n)}return this};return{channels:e,publish:r,subscribe:t,unsubscribe:n,installTo:function(e){e.subscribe=t,e.publish=r}}}),define("modules/CardModule",[],function(){function e(e,r){this.faceValue=e,this.value=n(e),this.suit=r,this.name=t(e)}function t(e){switch(e){case 1:return"A";case 11:return"J";case 12:return"Q";case 13:return"K";default:return e.toString()}}function n(e){return e>10?10:e}return e}),define("modules/DeckModule",["modules/CardModule"],function(e){function t(e){e=e||{},this.deckType=e.deckType||"52-card",this.cards=e.cards||n(this.deckType),this.topHand=e.topHand||undefined,this.bottomHand=e.bottomHand||undefined}function n(){return r()}function r(){var e=[];return e=e.concat(i("hearts")),e=e.concat(i("clubs")),e=e.concat(i("diams")),e=e.concat(i("spades")),e}function i(t){var n=[];for(var r=1;r<14;r++)n.push(new e(r,t));return n}return t.prototype.shuffle=function(){this.cards.length<52&&(this.cards=n(this.deckType));for(var e,t,r=this.cards.length;r;e=Math.floor(Math.random()*r),t=this.cards[--r],this.cards[r]=this.cards[e],this.cards[e]=t);return this},t.prototype.cut=function(){return this.cards.pop()},t.prototype.deal=function(){this.topHand=[],this.bottomHand=[];while(this.topHand.length<6)this.topHand.push(this.cards.pop()),this.bottomHand.push(this.cards.pop());return{topHand:this.topHand,bottomHand:this.bottomHand}},t.prototype.selectOne=function(e){var t=this.cards.splice(e,1)[0];return this.cards.push(t),t},t}),define("modules/PlayRulesModule",[],function(){function e(e){this.board=e.board}function t(e,t){return e+t.value>31}return e.prototype.isCardPlayable=function(e,n){return this.hasPlayableCards(e)?t(this.board.currentBoardValue,n)?!1:!0:!1},e.prototype.playableCards=function(e){var t=[];return e.hand.forEach(function(e){e.value<=31-this.board.currentBoardValue&&t.push(e)}.bind(this)),t},e.prototype.hasPlayableCards=function(e){return this.playableCards(e).length>0},e}),define("modules/BaseScoreKeeper",["modules/PubSub"],function(e){function t(){this.mediator=e}return t}),define("modules/PlayScoreKeeper",["modules/BaseScoreKeeper"],function(e){function t(){e.call(this)}return t.prototype=Object.create(e.prototype),t.prototype.constructor=t,t.prototype.isTwoForHisHeels=function(e){return e.faceValue===11},t.prototype.TwoForHisHeels=function(e,t){this.isTwoForHisHeels(t)&&(this.mediator.publish("messages-add",e.name+" scored two for his heels"),e.currentPoints=e.points,e.points+=2)},t.prototype.playCount=function(e){return e.reduce(function(e,t){return typeof e=="number"?e+t.value:e.value+t.value})},t.prototype.is15=function(e){return this.playCount(e)===15},t.prototype.is31=function(e){return this.playCount(e)===31},t.prototype.hasAtLeastOnePair=function(e){return e.length>1?e[e.length-1].faceValue===e[e.length-2].faceValue:!1},t.prototype.isLastCard=function(e){return e.length===8},t.prototype.iterateCardsForRun=function(e){function i(e,t,n){return t===n.length-1?!0:e.faceValue+1===n[t+1].faceValue}function s(e,t){return e.faceValue-t.faceValue}function o(){t=n.length}var t=0,n,r;for(var u=3;u<=e.length;u+=1){r=e.slice(e.length-u,e.length),n=r.sort(s);var a=n.every(i);a&&o()}return t},t.prototype.hasARun=function(e){function n(){return t>2}var t=this.iterateCardsForRun(e);return n()},t.prototype.scoreRun=function(e){var t=this.iterateCardsForRun(e);if(t>2)return t},t.prototype.scorePairs=function(e){var t=e[e.length-1],n=0;for(var r=e.length-2;r>=0;r--){if(t.faceValue!==e[r].faceValue)break;n++}return(n+1)*n},t.prototype.pointForGo=function(e){this.mediator.publish("messages-add",e.name+" scored 1 point."),e.currentPoints=e.points,e.points+=1},t.prototype.evaluatePlay=function(e,t,n){var r=0,i=0,s="";this.is15(t)&&(r+=2),this.is31(t)&&(r+=2),this.hasAtLeastOnePair(t)&&(r+=this.scorePairs(t)),this.hasARun(t)&&(r+=this.scoreRun(t)),this.isLastCard(n)&&(r+=1),isNaN(e.selectedScore)||(i=e.selectedScore-r,i>0?(this.mediator.publish("messages-add",e.name+" said "+e.selectedScore+" points"),this.mediator.publish("messages-add","the actual points were "+r),r=r-i>=0?r-i:0,s=" (-"+i+")"):(this.mediator.publish("messages-add",e.name+" found "+e.selectedScore+" of the total "+r+" points"),s=" (-"+(r-e.selectedScore)+")",r=e.selectedScore)),r!==0&&(e.currentPoints=e.points),e.points+=r,this.mediator.publish("messages-add",e.name+" scored "+r+" points"+s)},t}),define("modules/PlayerModule",["modules/PlayRulesModule","modules/PlayScoreKeeper","modules/PubSub"],function(e,t,n){function r(r){this.name=r.name,this.possessive=r.possessive,this.hand=r.hand||[],this.handInMemory=r.handInMemory||[],this.crib=r.crib||[],this.currentPoints=r.currentPoints||0,this.points=r.points||0,this.board=r.board,this.playRules=new e({board:r.board}),this.scoreKeeper=new t,this.mediator=n}function i(){this.scoreKeeper.evaluatePlay(this,this.board.playedCards,this.board.totalPlayedCardsForRound),this.board.currentBoardValue===31&&this.board.resetBoard()}r.prototype.getSelectedCards=function(){return this.hand.filter(function(e){return e.selected==="selected"})},r.prototype.placeCardsInCrib=function(e){function t(t){n.call(this,t),e.crib.push(this.hand.splice(this.hand.indexOf(t),1)[0])}function n(e){delete this.hand[this.hand.indexOf(e)].selected}this.getSelectedCards().length===2&&this.getSelectedCards().forEach(t.bind(this))},r.prototype.selectOneFromDeck=function(e,t){var n=e.selectOne(t);return this.scoreKeeper.TwoForHisHeels(this,n),n},r.prototype.selectCard=function(e){var t=this.hand.slice(),n=t.splice(e,1)[0],r=this.hand;if(!this.playRules.isCardPlayable(this,n))throw this.playRules.hasPlayableCards(this)?new Error("Invalid Playable Card"):new Error("No Playable Cards");s.isOneSelected(r,e)?s.replaceOldCard(r,e):s.selectCard(r,e)},r.prototype.placeCardOnTable=function(e){var t=this.hand.slice(),n=t.splice(e,1)[0];this.playRules.isCardPlayable(this,n)&&(this.board.placeCard(n,this),this.hand.splice(e,1))},r.prototype.playCard=function(e){var t=this.hand.slice(),n=t.splice(e,1)[0];if(this.selectedScore!==undefined)i.call(this),delete this.selectedScore;else{if(!this.playRules.isCardPlayable(this,n))throw this.playRules.hasPlayableCards(this)?new Error("Invalid Playable Card"):new Error("No Playable Cards");this.placeCardOnTable(e),i.call(this)}},r.prototype.announceGo=function(){if(!!this.playRules.hasPlayableCards(this))throw new Error("Playable Cards");this.mediator.publish("messages-add",this.name+" said GO"),this.board.announceGo(this)},r.prototype.isWinner=function(){var e=this.points>=121;return e&&this.mediator.publish("winner",this),e},r.prototype.restoreHand=function(){this.hand=this.handInMemory},r.prototype.selectCribCard=function(e){var t=this.hand;return s.isSelected(t,e)?s.unSelectCard(t,e):s.areTwoCardsSelected(t,e)?s.replaceOldCard(t,e):s.selectCard(t,e),this.getSelectedCards()};var s={selectCard:function(e,t){return e[t].selected="selected",e},unSelectCard:function(e,t){return delete e[t].selected,e},isSelected:function(e,t){return e[t].selected!==undefined},isOneSelected:function(e,t){var n=e.filter(function(e){return e.selected==="selected"});return n.length>=1&&n.indexOf(t)===-1},areTwoCardsSelected:function(e,t){var n=e.filter(function(e){return e.selected==="selected"});return n.length>1&&n.indexOf(t)===-1},replaceOldCard:function(e,t){var n=e.filter(function(e){return e.selected==="selected"})[0];return this.unSelectCard(e,e.indexOf(n)),this.selectCard(e,t)}};return r}),define("modules/PlayerAiModule",["modules/PlayerModule"],function(e){function t(t){e.call(this,t)}return t.prototype=Object.create(e.prototype),t.prototype.constructor=t,t.prototype.placeCardsInCrib=function(e){for(var t=0;t<2;t++){var n=Math.floor(Math.random()*this.hand.length);e.crib.push(this.hand.splice(n,1)[0])}},t.prototype.playCard=function(){var t=this.hand.filter(function(e){return this.playRules.isCardPlayable(this,e)}.bind(this))[0];return t?e.prototype.playCard.call(this,this.hand.indexOf(t)):this.announceGo()},t}),define("modules/BoardModule",[],function(){function e(e){this.currentBoardValue=e.currentBoardValue||0,this.totalPlayedCardsForRound=e.totalPlayedCardsForRound||[],this.playedCards=e.playedCards||[],this.playersWhoSaidGo=e.playersWhoSaidGo||[],this.scoreKeeper=e.scoreKeeper}return e.prototype.display=function(){return this.currentBoardValue>0?"inline-block":"none"},e.prototype.placeCard=function(e){this.playedCards.push(e),this.totalPlayedCardsForRound.push(e),this.currentBoardValue+=e.value},e.prototype.announceGo=function(e){function t(){return this.playersWhoSaidGo.indexOf(e.name)===-1&&this.playersWhoSaidGo.length>0}t.call(this)?(this.resetBoard(),this.scoreKeeper.pointForGo(e)):this.playersWhoSaidGo.push(e.name)},e.prototype.clearBoard=function(){this.totalPlayedCardsForRound=[],this.resetBoard()},e.prototype.resetBoard=function(){this.currentBoardValue=0,this.playedCards=[],this.playersWhoSaidGo=[]},e}),define("modules/GameModule",["modules/DeckModule","modules/PlayerModule","modules/PlayerAiModule","modules/BoardModule","modules/PlayScoreKeeper"],function(e,t,n,r,i){function s(s){this.$deck=new e(s.$deck);var o={scoreKeeper:new i};for(var u in s.$board)o[u]=s.$board[u];this.$board=new r(o);var a={name:"you",possessive:"your",board:this.$board};for(u in s.$player1)a[u]=s.$player1[u];this.$player1=new t(a);var f={name:"Opponent",possessive:"their",board:this.$board};for(u in s.$player2)f[u]=s.$player2[u];this.$player2=new n(f),s.$cribOwner&&(this.$cribOwner=[this.$player1,this.$player2].filter(function(e){return e.name===s.$cribOwner})[0]),this.$messages=s.$messages||[],this.$player1HandVisible=s.$player1HandVisible||!0,this.$player2HandVisible=s.$player2HandVisible||!0,this.countStateStep=s.countStateStep||undefined,this.topCard=s.topCard||undefined,this.$showTopCard=s.$showTopCard||undefined,this.$action=s.$action||undefined}return s});var Zepto=function(){function M(e){return e==null?String(e):x[T.call(e)]||"object"}function _(e){return M(e)=="function"}function D(e){return e!=null&&e==e.window}function P(e){return e!=null&&e.nodeType==e.DOCUMENT_NODE}function H(e){return M(e)=="object"}function B(e){return H(e)&&!D(e)&&Object.getPrototypeOf(e)==Object.prototype}function j(e){return typeof e.length=="number"}function F(e){return o.call(e,function(e){return e!=null})}function I(e){return e.length>0?n.fn.concat.apply([],e):e}function q(e){return e.replace(/::/g,"/").replace(/([A-Z]+)([A-Z][a-z])/g,"$1_$2").replace(/([a-z\d])([A-Z])/g,"$1_$2").replace(/_/g,"-").toLowerCase()}function R(e){return e in f?f[e]:f[e]=new RegExp("(^|\\s)"+e+"(\\s|$)")}function U(e,t){return typeof t=="number"&&!l[q(e)]?t+"px":t}function z(e){var t,n;return a[e]||(t=u.createElement(e),u.body.appendChild(t),n=getComputedStyle(t,"").getPropertyValue("display"),t.parentNode.removeChild(t),n=="none"&&(n="block"),a[e]=n),a[e]}function W(e){return"children"in e?s.call(e.children):n.map(e.childNodes,function(e){if(e.nodeType==1)return e})}function X(n,r,i){for(t in r)i&&(B(r[t])||O(r[t]))?(B(r[t])&&!B(n[t])&&(n[t]={}),O(r[t])&&!O(n[t])&&(n[t]=[]),X(n[t],r[t],i)):r[t]!==e&&(n[t]=r[t])}function V(e,t){return t==null?n(e):n(e).filter(t)}function $(e,t,n,r){return _(t)?t.call(e,n,r):t}function J(e,t,n){n==null?e.removeAttribute(t):e.setAttribute(t,n)}function K(t,n){var r=t.className,i=r&&r.baseVal!==e;if(n===e)return i?r.baseVal:r;i?r.baseVal=n:t.className=n}function Q(e){var t;try{return e?e=="true"||(e=="false"?!1:e=="null"?null:!/^0/.test(e)&&!isNaN(t=Number(e))?t:/^[\[\{]/.test(e)?n.parseJSON(e):e):e}catch(r){return e}}function G(e,t){t(e);for(var n=0,r=e.childNodes.length;n<r;n++)G(e.childNodes[n],t)}var e,t,n,r,i=[],s=i.slice,o=i.filter,u=window.document,a={},f={},l={"column-count":1,columns:1,"font-weight":1,"line-height":1,opacity:1,"z-index":1,zoom:1},c=/^\s*<(\w+|!)[^>]*>/,h=/^<(\w+)\s*\/?>(?:<\/\1>|)$/,p=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\w:]+)[^>]*)\/>/ig,d=/^(?:body|html)$/i,v=/([A-Z])/g,m=["val","css","html","text","data","width","height","offset"],g=["after","prepend","before","append"],y=u.createElement("table"),b=u.createElement("tr"),w={tr:u.createElement("tbody"),tbody:y,thead:y,tfoot:y,td:b,th:b,"*":u.createElement("div")},E=/complete|loaded|interactive/,S=/^[\w-]*$/,x={},T=x.toString,N={},C,k,L=u.createElement("div"),A={tabindex:"tabIndex",readonly:"readOnly","for":"htmlFor","class":"className",maxlength:"maxLength",cellspacing:"cellSpacing",cellpadding:"cellPadding",rowspan:"rowSpan",colspan:"colSpan",usemap:"useMap",frameborder:"frameBorder",contenteditable:"contentEditable"},O=Array.isArray||function(e){return e instanceof Array};return N.matches=function(e,t){if(!t||!e||e.nodeType!==1)return!1;var n=e.webkitMatchesSelector||e.mozMatchesSelector||e.oMatchesSelector||e.matchesSelector;if(n)return n.call(e,t);var r,i=e.parentNode,s=!i;return s&&(i=L).appendChild(e),r=~N.qsa(i,t).indexOf(e),s&&L.removeChild(e),r},C=function(e){return e.replace(/-+(.)?/g,function(e,t){return t?t.toUpperCase():""})},k=function(e){return o.call(e,function(t,n){return e.indexOf(t)==n})},N.fragment=function(t,r,i){var o,a,f;return h.test(t)&&(o=n(u.createElement(RegExp.$1))),o||(t.replace&&(t=t.replace(p,"<$1></$2>")),r===e&&(r=c.test(t)&&RegExp.$1),r in w||(r="*"),f=w[r],f.innerHTML=""+t,o=n.each(s.call(f.childNodes),function(){f.removeChild(this)})),B(i)&&(a=n(o),n.each(i,function(e,t){m.indexOf(e)>-1?a[e](t):a.attr(e,t)})),o},N.Z=function(e,t){return e=e||[],e.__proto__=n.fn,e.selector=t||"",e},N.isZ=function(e){return e instanceof N.Z},N.init=function(t,r){var i;if(!t)return N.Z();if(typeof t=="string"){t=t.trim();if(t[0]=="<"&&c.test(t))i=N.fragment(t,RegExp.$1,r),t=null;else{if(r!==e)return n(r).find(t);i=N.qsa(u,t)}}else{if(_(t))return n(u).ready(t);if(N.isZ(t))return t;if(O(t))i=F(t);else if(H(t))i=[t],t=null;else if(c.test(t))i=N.fragment(t.trim(),RegExp.$1,r),t=null;else{if(r!==e)return n(r).find(t);i=N.qsa(u,t)}}return N.Z(i,t)},n=function(e,t){return N.init(e,t)},n.extend=function(e){var t,n=s.call(arguments,1);return typeof e=="boolean"&&(t=e,e=n.shift()),n.forEach(function(n){X(e,n,t)}),e},N.qsa=function(e,t){var n,r=t[0]=="#",i=!r&&t[0]==".",o=r||i?t.slice(1):t,u=S.test(o);return P(e)&&u&&r?(n=e.getElementById(o))?[n]:[]:e.nodeType!==1&&e.nodeType!==9?[]:s.call(u&&!r?i?e.getElementsByClassName(o):e.getElementsByTagName(t):e.querySelectorAll(t))},n.contains=u.documentElement.contains?function(e,t){return e!==t&&e.contains(t)}:function(e,t){while(t&&(t=t.parentNode))if(t===e)return!0;return!1},n.type=M,n.isFunction=_,n.isWindow=D,n.isArray=O,n.isPlainObject=B,n.isEmptyObject=function(e){var t;for(t in e)return!1;return!0},n.inArray=function(e,t,n){return i.indexOf.call(t,e,n)},n.camelCase=C,n.trim=function(e){return e==null?"":String.prototype.trim.call(e)},n.uuid=0,n.support={},n.expr={},n.map=function(e,t){var n,r=[],i,s;if(j(e))for(i=0;i<e.length;i++)n=t(e[i],i),n!=null&&r.push(n);else for(s in e)n=t(e[s],s),n!=null&&r.push(n);return I(r)},n.each=function(e,t){var n,r;if(j(e)){for(n=0;n<e.length;n++)if(t.call(e[n],n,e[n])===!1)return e}else for(r in e)if(t.call(e[r],r,e[r])===!1)return e;return e},n.grep=function(e,t){return o.call(e,t)},window.JSON&&(n.parseJSON=JSON.parse),n.each("Boolean Number String Function Array Date RegExp Object Error".split(" "),function(e,t){x["[object "+t+"]"]=t.toLowerCase()}),n.fn={forEach:i.forEach,reduce:i.reduce,push:i.push,sort:i.sort,indexOf:i.indexOf,concat:i.concat,map:function(e){return n(n.map(this,function(t,n){return e.call(t,n,t)}))},slice:function(){return n(s.apply(this,arguments))},ready:function(e){return E.test(u.readyState)&&u.body?e(n):u.addEventListener("DOMContentLoaded",function(){e(n)},!1),this},get:function(t){return t===e?s.call(this):this[t>=0?t:t+this.length]},toArray:function(){return this.get()},size:function(){return this.length},remove:function(){return this.each(function(){this.parentNode!=null&&this.parentNode.removeChild(this)})},each:function(e){return i.every.call(this,function(t,n){return e.call(t,n,t)!==!1}),this},filter:function(e){return _(e)?this.not(this.not(e)):n(o.call(this,function(t){return N.matches(t,e)}))},add:function(e,t){return n(k(this.concat(n(e,t))))},is:function(e){return this.length>0&&N.matches(this[0],e)},not:function(t){var r=[];if(_(t)&&t.call!==e)this.each(function(e){t.call(this,e)||r.push(this)});else{var i=typeof t=="string"?this.filter(t):j(t)&&_(t.item)?s.call(t):n(t);this.forEach(function(e){i.indexOf(e)<0&&r.push(e)})}return n(r)},has:function(e){return this.filter(function(){return H(e)?n.contains(this,e):n(this).find(e).size()})},eq:function(e){return e===-1?this.slice(e):this.slice(e,+e+1)},first:function(){var e=this[0];return e&&!H(e)?e:n(e)},last:function(){var e=this[this.length-1];return e&&!H(e)?e:n(e)},find:function(e){var t,r=this;return e?typeof e=="object"?t=n(e).filter(function(){var e=this;return i.some.call(r,function(t){return n.contains(t,e)})}):this.length==1?t=n(N.qsa(this[0],e)):t=this.map(function(){return N.qsa(this,e)}):t=[],t},closest:function(e,t){var r=this[0],i=!1;typeof e=="object"&&(i=n(e));while(r&&!(i?i.indexOf(r)>=0:N.matches(r,e)))r=r!==t&&!P(r)&&r.parentNode;return n(r)},parents:function(e){var t=[],r=this;while(r.length>0)r=n.map(r,function(e){if((e=e.parentNode)&&!P(e)&&t.indexOf(e)<0)return t.push(e),e});return V(t,e)},parent:function(e){return V(k(this.pluck("parentNode")),e)},children:function(e){return V(this.map(function(){return W(this)}),e)},contents:function(){return this.map(function(){return s.call(this.childNodes)})},siblings:function(e){return V(this.map(function(e,t){return o.call(W(t.parentNode),function(e){return e!==t})}),e)},empty:function(){return this.each(function(){this.innerHTML=""})},pluck:function(e){return n.map(this,function(t){return t[e]})},show:function(){return this.each(function(){this.style.display=="none"&&(this.style.display=""),getComputedStyle(this,"").getPropertyValue("display")=="none"&&(this.style.display=z(this.nodeName))})},replaceWith:function(e){return this.before(e).remove()},wrap:function(e){var t=_(e);if(this[0]&&!t)var r=n(e).get(0),i=r.parentNode||this.length>1;return this.each(function(s){n(this).wrapAll(t?e.call(this,s):i?r.cloneNode(!0):r)})},wrapAll:function(e){if(this[0]){n(this[0]).before(e=n(e));var t;while((t=e.children()).length)e=t.first();n(e).append(this)}return this},wrapInner:function(e){var t=_(e);return this.each(function(r){var i=n(this),s=i.contents(),o=t?e.call(this,r):e;s.length?s.wrapAll(o):i.append(o)})},unwrap:function(){return this.parent().each(function(){n(this).replaceWith(n(this).children())}),this},clone:function(){return this.map(function(){return this.cloneNode(!0)})},hide:function(){return this.css("display","none")},toggle:function(t){return this.each(function(){var r=n(this);(t===e?r.css("display")=="none":t)?r.show():r.hide()})},prev:function(e){return n(this.pluck("previousElementSibling")).filter(e||"*")},next:function(e){return n(this.pluck("nextElementSibling")).filter(e||"*")},html:function(e){return 0 in arguments?this.each(function(t){var r=this.innerHTML;n(this).empty().append($(this,e,t,r))}):0 in this?this[0].innerHTML:null},text:function(e){return 0 in arguments?this.each(function(t){var n=$(this,e,t,this.textContent);this.textContent=n==null?"":""+n}):0 in this?this[0].textContent:null},attr:function(n,r){var i;return typeof n!="string"||1 in arguments?this.each(function(e){if(this.nodeType!==1)return;if(H(n))for(t in n)J(this,t,n[t]);else J(this,n,$(this,r,e,this.getAttribute(n)))}):!this.length||this[0].nodeType!==1?e:!(i=this[0].getAttribute(n))&&n in this[0]?this[0][n]:i},removeAttr:function(e){return this.each(function(){this.nodeType===1&&J(this,e)})},prop:function(e,t){return e=A[e]||e,1 in arguments?this.each(function(n){this[e]=$(this,t,n,this[e])}):this[0]&&this[0][e]},data:function(t,n){var r="data-"+t.replace(v,"-$1").toLowerCase(),i=1 in arguments?this.attr(r,n):this.attr(r);return i!==null?Q(i):e},val:function(e){return 0 in arguments?this.each(function(t){this.value=$(this,e,t,this.value)}):this[0]&&(this[0].multiple?n(this[0]).find("option").filter(function(){return this.selected}).pluck("value"):this[0].value)},offset:function(e){if(e)return this.each(function(t){var r=n(this),i=$(this,e,t,r.offset()),s=r.offsetParent().offset(),o={top:i.top-s.top,left:i.left-s.left};r.css("position")=="static"&&(o.position="relative"),r.css(o)});if(!this.length)return null;var t=this[0].getBoundingClientRect();return{left:t.left+window.pageXOffset,top:t.top+window.pageYOffset,width:Math.round(t.width),height:Math.round(t.height)}},css:function(e,r){if(arguments.length<2){var i=this[0],s=getComputedStyle(i,"");if(!i)return;if(typeof e=="string")return i.style[C(e)]||s.getPropertyValue(e);if(O(e)){var o={};return n.each(O(e)?e:[e],function(e,t){o[t]=i.style[C(t)]||s.getPropertyValue(t)}),o}}var u="";if(M(e)=="string")!r&&r!==0?this.each(function(){this.style.removeProperty(q(e))}):u=q(e)+":"+U(e,r);else for(t in e)!e[t]&&e[t]!==0?this.each(function(){this.style.removeProperty(q(t))}):u+=q(t)+":"+U(t,e[t])+";";return this.each(function(){this.style.cssText+=";"+u})},index:function(e){return e?this.indexOf(n(e)[0]):this.parent().children().indexOf(this[0])},hasClass:function(e){return e?i.some.call(this,function(e){return this.test(K(e))},R(e)):!1},addClass:function(e){return e?this.each(function(t){r=[];var i=K(this),s=$(this,e,t,i);s.split(/\s+/g).forEach(function(e){n(this).hasClass(e)||r.push(e)},this),r.length&&K(this,i+(i?" ":"")+r.join(" "))}):this},removeClass:function(t){return this.each(function(n){if(t===e)return K(this,"");r=K(this),$(this,t,n,r).split(/\s+/g).forEach(function(e){r=r.replace(R(e)," ")}),K(this,r.trim())})},toggleClass:function(t,r){return t?this.each(function(i){var s=n(this),o=$(this,t,i,K(this));o.split(/\s+/g).forEach(function(t){(r===e?!s.hasClass(t):r)?s.addClass(t):s.removeClass(t)})}):this},scrollTop:function(t){if(!this.length)return;var n="scrollTop"in this[0];return t===e?n?this[0].scrollTop:this[0].pageYOffset:this.each(n?function(){this.scrollTop=t}:function(){this.scrollTo(this.scrollX,t)})},scrollLeft:function(t){if(!this.length)return;var n="scrollLeft"in this[0];return t===e?n?this[0].scrollLeft:this[0].pageXOffset:this.each(n?function(){this.scrollLeft=t}:function(){this.scrollTo(t,this.scrollY)})},position:function(){if(!this.length)return;var e=this[0],t=this.offsetParent(),r=this.offset(),i=d.test(t[0].nodeName)?{top:0,left:0}:t.offset();return r.top-=parseFloat(n(e).css("margin-top"))||0,r.left-=parseFloat(n(e).css("margin-left"))||0,i.top+=parseFloat(n(t[0]).css("border-top-width"))||0,i.left+=parseFloat(n(t[0]).css("border-left-width"))||0,{top:r.top-i.top,left:r.left-i.left}},offsetParent:function(){return this.map(function(){var e=this.offsetParent||u.body;while(e&&!d.test(e.nodeName)&&n(e).css("position")=="static")e=e.offsetParent;return e})}},n.fn.detach=n.fn.remove,["width","height"].forEach(function(t){var r=t.replace(/./,function(e){return e[0].toUpperCase()});n.fn[t]=function(i){var s,o=this[0];return i===e?D(o)?o["inner"+r]:P(o)?o.documentElement["scroll"+r]:(s=this.offset())&&s[t]:this.each(function(e){o=n(this),o.css(t,$(this,i,e,o[t]()))})}}),g.forEach(function(e,t){var r=t%2;n.fn[e]=function(){var e,i=n.map(arguments,function(t){return e=M(t),e=="object"||e=="array"||t==null?t:N.fragment(t)}),s,o=this.length>1;return i.length<1?this:this.each(function(e,a){s=r?a:a.parentNode,a=t==0?a.nextSibling:t==1?a.firstChild:t==2?a:null;var f=n.contains(u.documentElement,s);i.forEach(function(e){if(o)e=e.cloneNode(!0);else if(!s)return n(e).remove();s.insertBefore(e,a),f&&G(e,function(e){e.nodeName!=null&&e.nodeName.toUpperCase()==="SCRIPT"&&(!e.type||e.type==="text/javascript")&&!e.src&&window.eval.call(window,e.innerHTML)})})})},n.fn[r?e+"To":"insert"+(t?"Before":"After")]=function(t){return n(t)[e](this),this}}),N.Z.prototype=n.fn,N.uniq=k,N.deserializeValue=Q,n.zepto=N,n}();window.Zepto=Zepto,window.$===undefined&&(window.$=Zepto),function(e){function c(e){return e._zid||(e._zid=t++)}function h(e,t,n,r){t=p(t);if(t.ns)var i=d(t.ns);return(o[c(e)]||[]).filter(function(e){return e&&(!t.e||e.e==t.e)&&(!t.ns||i.test(e.ns))&&(!n||c(e.fn)===c(n))&&(!r||e.sel==r)})}function p(e){var t=(""+e).split(".");return{e:t[0],ns:t.slice(1).sort().join(" ")}}function d(e){return new RegExp("(?:^| )"+e.replace(" "," .* ?")+"(?: |$)")}function v(e,t){return e.del&&!a&&e.e in f||!!t}function m(e){return l[e]||a&&f[e]||e}function g(t,r,i,s,u,a,f){var h=c(t),d=o[h]||(o[h]=[]);r.split(/\s/).forEach(function(r){if(r=="ready")return e(document).ready(i);var o=p(r);o.fn=i,o.sel=u,o.e in l&&(i=function(t){var n=t.relatedTarget;if(!n||n!==this&&!e.contains(this,n))return o.fn.apply(this,arguments)}),o.del=a;var c=a||i;o.proxy=function(e){e=x(e);if(e.isImmediatePropagationStopped())return;e.data=s;var r=c.apply(t,e._args==n?[e]:[e].concat(e._args));return r===!1&&(e.preventDefault(),e.stopPropagation()),r},o.i=d.length,d.push(o),"addEventListener"in t&&t.addEventListener(m(o.e),o.proxy,v(o,f))})}function y(e,t,n,r,i){var s=c(e);(t||"").split(/\s/).forEach(function(t){h(e,t,n,r).forEach(function(t){delete o[s][t.i],"removeEventListener"in e&&e.removeEventListener(m(t.e),t.proxy,v(t,i))})})}function x(t,r){if(r||!t.isDefaultPrevented){r||(r=t),e.each(S,function(e,n){var i=r[e];t[e]=function(){return this[n]=b,i&&i.apply(r,arguments)},t[n]=w});if(r.defaultPrevented!==n?r.defaultPrevented:"returnValue"in r?r.returnValue===!1:r.getPreventDefault&&r.getPreventDefault())t.isDefaultPrevented=b}return t}function T(e){var t,r={originalEvent:e};for(t in e)!E.test(t)&&e[t]!==n&&(r[t]=e[t]);return x(r,e)}var t=1,n,r=Array.prototype.slice,i=e.isFunction,s=function(e){return typeof e=="string"},o={},u={},a="onfocusin"in window,f={focus:"focusin",blur:"focusout"},l={mouseenter:"mouseover",mouseleave:"mouseout"};u.click=u.mousedown=u.mouseup=u.mousemove="MouseEvents",e.event={add:g,remove:y},e.proxy=function(t,n){var o=2 in arguments&&r.call(arguments,2);if(i(t)){var u=function(){return t.apply(n,o?o.concat(r.call(arguments)):arguments)};return u._zid=c(t),u}if(s(n))return o?(o.unshift(t[n],t),e.proxy.apply(null,o)):e.proxy(t[n],t);throw new TypeError("expected function")},e.fn.bind=function(e,t,n){return this.on(e,t,n)},e.fn.unbind=function(e,t){return this.off(e,t)},e.fn.one=function(e,t,n,r){return this.on(e,t,n,r,1)};var b=function(){return!0},w=function(){return!1},E=/^([A-Z]|returnValue$|layer[XY]$)/,S={preventDefault:"isDefaultPrevented",stopImmediatePropagation:"isImmediatePropagationStopped",stopPropagation:"isPropagationStopped"};e.fn.delegate=function(e,t,n){return this.on(t,e,n)},e.fn.undelegate=function(e,t,n){return this.off(t,e,n)},e.fn.live=function(t,n){return e(document.body).delegate(this.selector,t,n),this},e.fn.die=function(t,n){return e(document.body).undelegate(this.selector,t,n),this},e.fn.on=function(t,o,u,a,f){var l,c,h=this;if(t&&!s(t))return e.each(t,function(e,t){h.on(e,o,u,t,f)}),h;!s(o)&&!i(a)&&a!==!1&&(a=u,u=o,o=n);if(i(u)||u===!1)a=u,u=n;return a===!1&&(a=w),h.each(function(n,i){f&&(l=function(e){return y(i,e.type,a),a.apply(this,arguments)}),o&&(c=function(t){var n,s=e(t.target).closest(o,i).get(0);if(s&&s!==i)return n=e.extend(T(t),{currentTarget:s,liveFired:i}),(l||a).apply(s,[n].concat(r.call(arguments,1)))}),g(i,t,a,u,o,c||l)})},e.fn.off=function(t,r,o){var u=this;return t&&!s(t)?(e.each(t,function(e,t){u.off(e,r,t)}),u):(!s(r)&&!i(o)&&o!==!1&&(o=r,r=n),o===!1&&(o=w),u.each(function(){y(this,t,o,r)}))},e.fn.trigger=function(t,n){return t=s(t)||e.isPlainObject(t)?e.Event(t):x(t),t._args=n,this.each(function(){"dispatchEvent"in this?this.dispatchEvent(t):e(this).triggerHandler(t,n)})},e.fn.triggerHandler=function(t,n){var r,i;return this.each(function(o,u){r=T(s(t)?e.Event(t):t),r._args=n,r.target=u,e.each(h(u,t.type||t),function(e,t){i=t.proxy(r);if(r.isImmediatePropagationStopped())return!1})}),i},"focusin focusout load resize scroll unload click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select keydown keypress keyup error".split(" ").forEach(function(t){e.fn[t]=function(e){return e?this.bind(t,e):this.trigger(t)}}),["focus","blur"].forEach(function(t){e.fn[t]=function(e){return e?this.bind(t,e):this.each(function(){try{this[t]()}catch(e){}}),this}}),e.Event=function(e,t){s(e)||(t=e,e=t.type);var n=document.createEvent(u[e]||"Events"),r=!0;if(t)for(var i in t)i=="bubbles"?r=!!t[i]:n[i]=t[i];return n.initEvent(e,r,!0),x(n)}}(Zepto),function($){function triggerAndReturn(e,t,n){var r=$.Event(t);return $(e).trigger(r,n),!r.isDefaultPrevented()}function triggerGlobal(e,t,n,r){if(e.global)return triggerAndReturn(t||document,n,r)}function ajaxStart(e){e.global&&$.active++===0&&triggerGlobal(e,null,"ajaxStart")}function ajaxStop(e){e.global&&!--$.active&&triggerGlobal(e,null,"ajaxStop")}function ajaxBeforeSend(e,t){var n=t.context;if(t.beforeSend.call(n,e,t)===!1||triggerGlobal(t,n,"ajaxBeforeSend",[e,t])===!1)return!1;triggerGlobal(t,n,"ajaxSend",[e,t])}function ajaxSuccess(e,t,n,r){var i=n.context,s="success";n.success.call(i,e,s,t),r&&r.resolveWith(i,[e,s,t]),triggerGlobal(n,i,"ajaxSuccess",[t,n,e]),ajaxComplete(s,t,n)}function ajaxError(e,t,n,r,i){var s=r.context;r.error.call(s,n,t,e),i&&i.rejectWith(s,[n,t,e]),triggerGlobal(r,s,"ajaxError",[n,r,e||t]),ajaxComplete(t,n,r)}function ajaxComplete(e,t,n){var r=n.context;n.complete.call(r,t,e),triggerGlobal(n,r,"ajaxComplete",[t,n]),ajaxStop(n)}function empty(){}function mimeToDataType(e){return e&&(e=e.split(";",2)[0]),e&&(e==htmlType?"html":e==jsonType?"json":scriptTypeRE.test(e)?"script":xmlTypeRE.test(e)&&"xml")||"text"}function appendQuery(e,t){return t==""?e:(e+"&"+t).replace(/[&?]{1,2}/,"?")}function serializeData(e){e.processData&&e.data&&$.type(e.data)!="string"&&(e.data=$.param(e.data,e.traditional)),e.data&&(!e.type||e.type.toUpperCase()=="GET")&&(e.url=appendQuery(e.url,e.data),e.data=undefined)}function parseArguments(e,t,n,r){return $.isFunction(t)&&(r=n,n=t,t=undefined),$.isFunction(n)||(r=n,n=undefined),{url:e,data:t,success:n,dataType:r}}function serialize(e,t,n,r){var i,s=$.isArray(t),o=$.isPlainObject(t);$.each(t,function(t,u){i=$.type(u),r&&(t=n?r:r+"["+(o||i=="object"||i=="array"?t:"")+"]"),!r&&s?e.add(u.name,u.value):i=="array"||!n&&i=="object"?serialize(e,u,n,t):e.add(t,u)})}var jsonpID=0,document=window.document,key,name,rscript=/<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/gi,scriptTypeRE=/^(?:text|application)\/javascript/i,xmlTypeRE=/^(?:text|application)\/xml/i,jsonType="application/json",htmlType="text/html",blankRE=/^\s*$/;$.active=0,$.ajaxJSONP=function(e,t){if("type"in e){var n=e.jsonpCallback,r=($.isFunction(n)?n():n)||"jsonp"+ ++jsonpID,i=document.createElement("script"),s=window[r],o,u=function(e){$(i).triggerHandler("error",e||"abort")},a={abort:u},f;return t&&t.promise(a),$(i).on("load error",function(n,u){clearTimeout(f),$(i).off().remove(),n.type=="error"||!o?ajaxError(null,u||"error",a,e,t):ajaxSuccess(o[0],a,e,t),window[r]=s,o&&$.isFunction(s)&&s(o[0]),s=o=undefined}),ajaxBeforeSend(a,e)===!1?(u("abort"),a):(window[r]=function(){o=arguments},i.src=e.url.replace(/\?(.+)=\?/,"?$1="+r),document.head.appendChild(i),e.timeout>0&&(f=setTimeout(function(){u("timeout")},e.timeout)),a)}return $.ajax(e)},$.ajaxSettings={type:"GET",beforeSend:empty,success:empty,error:empty,complete:empty,context:null,global:!0,xhr:function(){return new window.XMLHttpRequest},accepts:{script:"text/javascript, application/javascript, application/x-javascript",json:jsonType,xml:"application/xml, text/xml",html:htmlType,text:"text/plain"},crossDomain:!1,timeout:0,processData:!0,cache:!0},$.ajax=function(options){var settings=$.extend({},options||{}),deferred=$.Deferred&&$.Deferred();for(key in $.ajaxSettings)settings[key]===undefined&&(settings[key]=$.ajaxSettings[key]);ajaxStart(settings),settings.crossDomain||(settings.crossDomain=/^([\w-]+:)?\/\/([^\/]+)/.test(settings.url)&&RegExp.$2!=window.location.host),settings.url||(settings.url=window.location.toString()),serializeData(settings);var dataType=settings.dataType,hasPlaceholder=/\?.+=\?/.test(settings.url);hasPlaceholder&&(dataType="jsonp");if(settings.cache===!1||(!options||options.cache!==!0)&&("script"==dataType||"jsonp"==dataType))settings.url=appendQuery(settings.url,"_="+Date.now());if("jsonp"==dataType)return hasPlaceholder||(settings.url=appendQuery(settings.url,settings.jsonp?settings.jsonp+"=?":settings.jsonp===!1?"":"callback=?")),$.ajaxJSONP(settings,deferred);var mime=settings.accepts[dataType],headers={},setHeader=function(e,t){headers[e.toLowerCase()]=[e,t]},protocol=/^([\w-]+:)\/\//.test(settings.url)?RegExp.$1:window.location.protocol,xhr=settings.xhr(),nativeSetHeader=xhr.setRequestHeader,abortTimeout;deferred&&deferred.promise(xhr),settings.crossDomain||setHeader("X-Requested-With","XMLHttpRequest"),setHeader("Accept",mime||"*/*");if(mime=settings.mimeType||mime)mime.indexOf(",")>-1&&(mime=mime.split(",",2)[0]),xhr.overrideMimeType&&xhr.overrideMimeType(mime);(settings.contentType||settings.contentType!==!1&&settings.data&&settings.type.toUpperCase()!="GET")&&setHeader("Content-Type",settings.contentType||"application/x-www-form-urlencoded");if(settings.headers)for(name in settings.headers)setHeader(name,settings.headers[name]);xhr.setRequestHeader=setHeader,xhr.onreadystatechange=function(){if(xhr.readyState==4){xhr.onreadystatechange=empty,clearTimeout(abortTimeout);var result,error=!1;if(xhr.status>=200&&xhr.status<300||xhr.status==304||xhr.status==0&&protocol=="file:"){dataType=dataType||mimeToDataType(settings.mimeType||xhr.getResponseHeader("content-type")),result=xhr.responseText;try{dataType=="script"?(1,eval)(result):dataType=="xml"?result=xhr.responseXML:dataType=="json"&&(result=blankRE.test(result)?null:$.parseJSON(result))}catch(e){error=e}error?ajaxError(error,"parsererror",xhr,settings,deferred):ajaxSuccess(result,xhr,settings,deferred)}else ajaxError(xhr.statusText||null,xhr.status?"error":"abort",xhr,settings,deferred)}};if(ajaxBeforeSend(xhr,settings)===!1)return xhr.abort(),ajaxError(null,"abort",xhr,settings,deferred),xhr;if(settings.xhrFields)for(name in settings.xhrFields)xhr[name]=settings.xhrFields[name];var async="async"in settings?settings.async:!0;xhr.open(settings.type,settings.url,async,settings.username,settings.password);for(name in headers)nativeSetHeader.apply(xhr,headers[name]);return settings.timeout>0&&(abortTimeout=setTimeout(function(){xhr.onreadystatechange=empty,xhr.abort(),ajaxError(null,"timeout",xhr,settings,deferred)},settings.timeout)),xhr.send(settings.data?settings.data:null),xhr},$.get=function(){return $.ajax(parseArguments.apply(null,arguments))},$.post=function(){var e=parseArguments.apply(null,arguments);return e.type="POST",$.ajax(e)},$.getJSON=function(){var e=parseArguments.apply(null,arguments);return e.dataType="json",$.ajax(e)},$.fn.load=function(e,t,n){if(!this.length)return this;var r=this,i=e.split(/\s/),s,o=parseArguments(e,t,n),u=o.success;return i.length>1&&(o.url=i[0],s=i[1]),o.success=function(e){r.html(s?$("<div>").html(e.replace(rscript,"")).find(s):e),u&&u.apply(r,arguments)},$.ajax(o),this};var escape=encodeURIComponent;$.param=function(e,t){var n=[];return n.add=function(e,t){this.push(escape(e)+"="+escape(t))},serialize(n,e,t),n.join("&").replace(/%20/g,"+")}}(Zepto),function(e){e.fn.serializeArray=function(){var t=[],n;return e([].slice.call(this.get(0).elements)).each(function(){n=e(this);var r=n.attr("type");this.nodeName.toLowerCase()!="fieldset"&&!this.disabled&&r!="submit"&&r!="reset"&&r!="button"&&(r!="radio"&&r!="checkbox"||this.checked)&&t.push({name:n.attr("name"),value:n.val()})}),t},e.fn.serialize=function(){var e=[];return this.serializeArray().forEach(function(t){e.push(encodeURIComponent(t.name)+"="+encodeURIComponent(t.value))}),e.join("&")},e.fn.submit=function(t){if(t)this.bind("submit",t);else if(this.length){var n=e.Event("submit");this.eq(0).trigger(n),n.isDefaultPrevented()||this.get(0).submit()}return this}}(Zepto),function(e){"__proto__"in{}||e.extend(e.zepto,{Z:function(t,n){return t=t||[],e.extend(t,e.fn),t.selector=n||"",t.__Z=!0,t},isZ:function(t){return e.type(t)==="array"&&"__Z"in t}});try{getComputedStyle(undefined)}catch(t){var n=getComputedStyle;window.getComputedStyle=function(e){try{return n(e)}catch(t){return null}}}}(Zepto),define("jquery",function(e){return function(){var t,n;return t||e.$}}(this)),function(e,t){if(typeof exports=="object"&&exports)t(exports);else{var n={};t(n),typeof define=="function"&&define.amd?define("mustache",n):e.Mustache=n}}(this,function(e){function n(e,n){return t.call(e,n)}function i(e){return!n(r,e)}function u(e){return typeof e=="function"}function a(e){return e.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")}function l(e){return String(e).replace(/[&<>"'\/]/g,function(e){return f[e]})}function c(e){if(!o(e)||e.length!==2)throw new Error("Invalid tags: "+e);return[new RegExp(a(e[0])+"\\s*"),new RegExp("\\s*"+a(e[1]))]}function g(t,n){function E(){if(l&&!g)while(f.length)delete u[f.pop()];else f=[];l=!1,g=!1}n=n||e.tags,t=t||"",typeof n=="string"&&(n=n.split(p));var r=c(n),s=new w(t),o=[],u=[],f=[],l=!1,g=!1,S,x,T,N,C,k;while(!s.eos()){S=s.pos,T=s.scanUntil(r[0]);if(T)for(var L=0,A=T.length;L<A;++L)N=T.charAt(L),i(N)?f.push(u.length):g=!0,u.push(["text",N,S,S+1]),S+=1,N==="\n"&&E();if(!s.scan(r[0]))break;l=!0,x=s.scan(m)||"name",s.scan(h),x==="="?(T=s.scanUntil(d),s.scan(d),s.scanUntil(r[1])):x==="{"?(T=s.scanUntil(new RegExp("\\s*"+a("}"+n[1]))),s.scan(v),s.scanUntil(r[1]),x="&"):T=s.scanUntil(r[1]);if(!s.scan(r[1]))throw new Error("Unclosed tag at "+s.pos);C=[x,T,S,s.pos],u.push(C);if(x==="#"||x==="^")o.push(C);else if(x==="/"){k=o.pop();if(!k)throw new Error('Unopened section "'+T+'" at '+S);if(k[1]!==T)throw new Error('Unclosed section "'+k[1]+'" at '+S)}else x==="name"||x==="{"||x==="&"?g=!0:x==="="&&(r=c(n=T.split(p)))}k=o.pop();if(k)throw new Error('Unclosed section "'+k[1]+'" at '+s.pos);return b(y(u))}function y(e){var t=[],n,r;for(var i=0,s=e.length;i<s;++i)n=e[i],n&&(n[0]==="text"&&r&&r[0]==="text"?(r[1]+=n[1],r[3]=n[3]):(t.push(n),r=n));return t}function b(e){var t=[],n=t,r=[],i,s;for(var o=0,u=e.length;o<u;++o){i=e[o];switch(i[0]){case"#":case"^":n.push(i),r.push(i),n=i[4]=[];break;case"/":s=r.pop(),s[5]=i[2],n=r.length>0?r[r.length-1][4]:t;break;default:n.push(i)}}return t}function w(e){this.string=e,this.tail=e,this.pos=0}function E(e,t){this.view=e==null?{}:e,this.cache={".":this.view},this.parent=t}function S(){this.cache={}}var t=RegExp.prototype.test,r=/\S/,s=Object.prototype.toString,o=Array.isArray||function(e){return s.call(e)==="[object Array]"},f={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;"},h=/\s*/,p=/\s+/,d=/\s*=/,v=/\s*\}/,m=/#|\^|\/|>|\{|&|=|!/;w.prototype.eos=function(){return this.tail===""},w.prototype.scan=function(e){var t=this.tail.match(e);if(t&&t.index===0){var n=t[0];return this.tail=this.tail.substring(n.length),this.pos+=n.length,n}return""},w.prototype.scanUntil=function(e){var t=this.tail.search(e),n;switch(t){case-1:n=this.tail,this.tail="";break;case 0:n="";break;default:n=this.tail.substring(0,t),this.tail=this.tail.substring(t)}return this.pos+=n.length,n},E.prototype.push=function(e){return new E(e,this)},E.prototype.lookup=function(e){var t;if(e in this.cache)t=this.cache[e];else{var n=this;while(n){if(e.indexOf(".")>0){t=n.view;var r=e.split("."),i=0;while(t!=null&&i<r.length)t=t[r[i++]]}else t=n.view[e];if(t!=null)break;n=n.parent}this.cache[e]=t}return u(t)&&(t=t.call(this.view)),t},S.prototype.clearCache=function(){this.cache={}},S.prototype.parse=function(e,t){var n=this.cache,r=n[e];return r==null&&(r=n[e]=g(e,t)),r},S.prototype.render=function(e,t,n){var r=this.parse(e),i=t instanceof E?t:new E(t);return this.renderTokens(r,i,n,e)},S.prototype.renderTokens=function(t,n,r,i){function f(e){return a.render(e,n,r)}var s="",a=this,l,c;for(var h=0,p=t.length;h<p;++h){l=t[h];switch(l[0]){case"#":c=n.lookup(l[1]);if(!c)continue;if(o(c))for(var d=0,v=c.length;d<v;++d)s+=this.renderTokens(l[4],n.push(c[d]),r,i);else if(typeof c=="object"||typeof c=="string")s+=this.renderTokens(l[4],n.push(c),r,i);else if(u(c)){if(typeof i!="string")throw new Error("Cannot use higher-order sections without the original template");c=c.call(n.view,i.slice(l[3],l[5]),f),c!=null&&(s+=c)}else s+=this.renderTokens(l[4],n,r,i);break;case"^":c=n.lookup(l[1]);if(!c||o(c)&&c.length===0)s+=this.renderTokens(l[4],n,r,i);break;case">":if(!r)continue;c=u(r)?r(l[1]):r[l[1]],c!=null&&(s+=this.renderTokens(this.parse(c),n,r,c));break;case"&":c=n.lookup(l[1]),c!=null&&(s+=c);break;case"name":c=n.lookup(l[1]),c!=null&&(s+=e.escape(c));break;case"text":s+=l[1]}}return s},e.name="mustache.js",e.version="0.8.1",e.tags=["{{","}}"];var x=new S;e.clearCache=function(){return x.clearCache()},e.parse=function(e,t){return x.parse(e,t)},e.render=function(e,t,n){return x.render(e,t,n)},e.to_html=function(t,n,r,i){var s=e.render(t,n,r);if(!u(i))return s;i(s)},e.escape=l,e.Scanner=w,e.Context=E,e.Writer=S}),define("text",["module"],function(e){var t,n,r,i,s,o=["Msxml2.XMLHTTP","Microsoft.XMLHTTP","Msxml2.XMLHTTP.4.0"],u=/^\s*<\?xml(\s)+version=[\'\"](\d)*.(\d)*[\'\"](\s)*\?>/im,a=/<body[^>]*>\s*([\s\S]+)\s*<\/body>/im,f=typeof location!="undefined"&&location.href,l=f&&location.protocol&&location.protocol.replace(/\:/,""),c=f&&location.hostname,h=f&&(location.port||undefined),p={},d=e.config&&e.config()||{};t={version:"2.0.13",strip:function(e){if(e){e=e.replace(u,"");var t=e.match(a);t&&(e=t[1])}else e="";return e},jsEscape:function(e){return e.replace(/(['\\])/g,"\\$1").replace(/[\f]/g,"\\f").replace(/[\b]/g,"\\b").replace(/[\n]/g,"\\n").replace(/[\t]/g,"\\t").replace(/[\r]/g,"\\r").replace(/[\u2028]/g,"\\u2028").replace(/[\u2029]/g,"\\u2029")},createXhr:d.createXhr||function(){var e,t,n;if(typeof XMLHttpRequest!="undefined")return new XMLHttpRequest;if(typeof ActiveXObject!="undefined")for(t=0;t<3;t+=1){n=o[t];try{e=new ActiveXObject(n)}catch(r){}if(e){o=[n];break}}return e},parseName:function(e){var t,n,r,i=!1,s=e.lastIndexOf("."),o=e.indexOf("./")===0||e.indexOf("../")===0;return s!==-1&&(!o||s>1)?(t=e.substring(0,s),n=e.substring(s+1)):t=e,r=n||t,s=r.indexOf("!"),s!==-1&&(i=r.substring(s+1)==="strip",r=r.substring(0,s),n?n=r:t=r),{moduleName:t,ext:n,strip:i}},xdRegExp:/^((\w+)\:)?\/\/([^\/\\]+)/,useXhr:function(e,n,r,i){var s,o,u,a=t.xdRegExp.exec(e);return a?(s=a[2],o=a[3],o=o.split(":"),u=o[1],o=o[0],(!s||s===n)&&(!o||o.toLowerCase()===r.toLowerCase())&&(!u&&!o||u===i)):!0},finishLoad:function(e,n,r,i){r=n?t.strip(r):r,d.isBuild&&(p[e]=r),i(r)},load:function(e,n,r,i){if(i&&i.isBuild&&!i.inlineText){r();return}d.isBuild=i&&i.isBuild;var s=t.parseName(e),o=s.moduleName+(s.ext?"."+s.ext:""),u=n.toUrl(o),a=d.useXhr||t.useXhr;if(u.indexOf("empty:")===0){r();return}!f||a(u,l,c,h)?t.get(u,function(n){t.finishLoad(e,s.strip,n,r)},function(e){r.error&&r.error(e)}):n([o],function(e){t.finishLoad(s.moduleName+"."+s.ext,s.strip,e,r)})},write:function(e,n,r,i){if(p.hasOwnProperty(n)){var s=t.jsEscape(p[n]);r.asModule(e+"!"+n,"define(function () { return '"+s+"';});\n")}},writeFile:function(e,n,r,i,s){var o=t.parseName(n),u=o.ext?"."+o.ext:"",a=o.moduleName+u,f=r.toUrl(o.moduleName+u)+".js";t.load(a,r,function(n){var r=function(e){return i(f,e)};r.asModule=function(e,t){return i.asModule(e,f,t)},t.write(e,a,r,s)},s)}};if(d.env==="node"||!d.env&&typeof process!="undefined"&&process.versions&&!!process.versions.node&&!process.versions["node-webkit"])n=require.nodeRequire("fs"),t.get=function(e,t,r){try{var i=n.readFileSync(e,"utf8");i[0]==="﻿"&&(i=i.substring(1)),t(i)}catch(s){r&&r(s)}};else if(d.env==="xhr"||!d.env&&t.createXhr())t.get=function(e,n,r,i){var s=t.createXhr(),o;s.open("GET",e,!0);if(i)for(o in i)i.hasOwnProperty(o)&&s.setRequestHeader(o.toLowerCase(),i[o]);d.onXhr&&d.onXhr(s,e),s.onreadystatechange=function(t){var i,o;s.readyState===4&&(i=s.status||0,i>399&&i<600?(o=new Error(e+" HTTP status: "+i),o.xhr=s,r&&r(o)):n(s.responseText),d.onXhrComplete&&d.onXhrComplete(s,e))},s.send(null)};else if(d.env==="rhino"||!d.env&&typeof Packages!="undefined"&&typeof java!="undefined")t.get=function(e,t){var n,r,i="utf-8",s=new java.io.File(e),o=java.lang.System.getProperty("line.separator"),u=new java.io.BufferedReader(new java.io.InputStreamReader(new java.io.FileInputStream(s),i)),a="";try{n=new java.lang.StringBuffer,r=u.readLine(),r&&r.length()&&r.charAt(0)===65279&&(r=r.substring(1)),r!==null&&n.append(r);while((r=u.readLine())!==null)n.append(o),n.append(r);a=String(n.toString())}finally{u.close()}t(a)};else if(d.env==="xpconnect"||!d.env&&typeof Components!="undefined"&&Components.classes&&Components.interfaces)r=Components.classes,i=Components.interfaces,Components.utils["import"]("resource://gre/modules/FileUtils.jsm"),s="@mozilla.org/windows-registry-key;1"in r,t.get=function(e,t){var n,o,u,a={};s&&(e=e.replace(/\//g,"\\")),u=new FileUtils.File(e);try{n=r["@mozilla.org/network/file-input-stream;1"].createInstance(i.nsIFileInputStream),n.init(u,1,0,!1),o=r["@mozilla.org/intl/converter-input-stream;1"].createInstance(i.nsIConverterInputStream),o.init(n,"utf-8",n.available(),i.nsIConverterInputStream.DEFAULT_REPLACEMENT_CHARACTER),o.readString(n.available(),a),o.close(),n.close(),t(a.value)}catch(f){throw new Error((u&&u.path||"")+": "+f)}};return t}),define("text!templates/game.html",[],function(){return'<div id="gameContainer">\n  <a class="link home-link"><i class="fa fa-home"></i></a>\n\n  <div id="cribbageBoard">\n    {{#someFunction}}someValue{{/someFunction}}\n    {{#$player1}}\n    {{> p1Score}}\n    {{/$player1}}\n    {{#$player2}}\n    {{> p2Score}}\n    {{/$player2}}\n  </div>\n  <a class="link help-link"><i class="fa fa-question"></i></a>\n\n  <div id="player2" class="player">\n    {{#$player2}}\n    <div class="playingCards">\n      <ul id="topHand" class="hand">{{#hand}}{{> p2Hand}}{{/hand}}</ul>\n      <ul class="crib deck">{{#crib}}{{> crib}}{{/crib}}</ul>\n    </div>\n    {{/$player2}}\n  </div>\n  <div id="table">\n    <div id="deck" class="playingCards">{{> deck}}</div>\n    <div id="count">{{#$board}}<label style="display: {{display}}">Count: <span>{{currentBoardValue}}</span></label>{{/$board}}\n    </div>\n    <div id="play" class="playingCards">\n      <ul class="hand play">{{#$board}}{{> play}}{{/$board}}</ul>\n    </div>\n    <div id="controls">{{#$action}}{{> controls}}{{/$action}}</div>\n  </div>\n  <div id="player1" class="player">\n    {{#$player1}}\n    <div class="playingCards">\n      <ul id="bottomHand" class="hand">{{#hand}}{{> p1Hand}}{{/hand}}</ul>\n      <ul class="crib deck">{{#crib}}{{> crib}}{{/crib}}</ul>\n      {{> scoreControl}}\n    </div>\n    {{/$player1}}\n  </div>\n  <ul id="messageContainer">{{> messages}}</ul>\n</div>\n'}),define("text!templates/game.visibleHand.html",[],function(){return'<li>\n  <a class="card rank-{{name}} {{suit}} {{selected}}">\n    <span class="rank">{{name}}</span>\n    <span class="suit">&{{suit}};</span>\n  </a>\n</li>\n'}),define("text!templates/game.hiddenHand.html",[],function(){return'<li class="card back">*</li>\n'}),define("text!templates/game.hiddenDeck.html",[],function(){return'<ul class="deck">\n  <li class="card back">*</li>\n  <li class="card back">*</li>\n  <li class="card back">*</li>\n  <li class="card back">*</li>\n  <li class="card back">*</li>\n  <li class="card back">*</li>\n  <li class="card back">*</li>\n</ul>\n'}),define("text!templates/game.play.html",[],function(){return'{{#playedCards}}\n  <li>\n    <a class="card rank-{{name}} {{suit}}">\n      <span class="rank">{{name}}</span>\n      <span class="suit">&{{suit}};</span>\n    </a>\n  </li>\n{{/playedCards}}\n'}),define("text!templates/game.scoreboard.html",[],function(){return"<ul>\n  <li></li>\n  <li></li>\n  <li></li>\n  <li></li>\n  <li></li>\n\n  <li></li>\n  <li></li>\n  <li></li>\n  <li></li>\n  <li></li>\n\n  <li></li>\n  <li></li>\n  <li></li>\n  <li></li>\n  <li></li>\n\n  <li></li>\n  <li></li>\n  <li></li>\n  <li></li>\n  <li></li>\n\n  <li></li>\n  <li></li>\n  <li></li>\n  <li></li>\n  <li></li>\n\n  <li></li>\n  <li></li>\n  <li></li>\n  <li></li>\n  <li></li>\n\n  <li></li>\n  <li></li>\n  <li></li>\n  <li></li>\n  <li></li>\n\n  <li></li>\n  <li></li>\n  <li></li>\n  <li></li>\n  <li></li>\n\n  <li></li>\n  <li></li>\n  <li></li>\n  <li></li>\n  <li></li>\n\n  <li></li>\n  <li></li>\n  <li></li>\n  <li></li>\n  <li></li>\n\n  <li></li>\n  <li></li>\n  <li></li>\n  <li></li>\n  <li></li>\n\n  <li></li>\n  <li></li>\n  <li></li>\n  <li></li>\n  <li></li>\n</ul>\n"}),define("text!templates/game.controls.html",[],function(){return'<span>{{$player2.name}}: {{$player2.points}}</span>\n<button style="display:{{display}}">{{text}}</button>\n<span>{{$player1.name}}: {{$player1.points}}</span>\n'}),define("gameStates/BaseState",["jquery","mustache","modules/PubSub","text!templates/game.html","text!templates/game.visibleHand.html","text!templates/game.hiddenHand.html","text!templates/game.hiddenDeck.html","text!templates/game.play.html","text!templates/game.scoreboard.html","text!templates/game.controls.html"],function(e,t,n,r,i,s,o,u,a,f){function l(e,t){this.game=e,this.name=t,this.mediator=n,e&&(this.p1=e.$player1,this.p2=e.$player2,this.data=this.game)}function c(e){return e<31?e:e>=31&&e<61?61-(e-30):e>=61&&e<91?e-60:e>=91&&e<121?61-(e-90):0}function h(t){var n={leadPoint:c(t.$player1.points),currentPoint:c(t.$player1.currentPoints)},r={leadPoint:c(t.$player2.points),currentPoint:c(t.$player2.currentPoints)};e("#cribbageBoard ul:first-of-type li:nth-child("+r.leadPoint+")").addClass("player2-board-peg"),e(" #cribbageBoard ul:first-of-type li:nth-child("+r.currentPoint+")").addClass("player2-board-peg"),e("#cribbageBoard ul:nth-of-type(2) li:nth-child("+n.leadPoint+")").addClass("player1-board-peg"),e(" #cribbageBoard ul:nth-of-type(2) li:nth-child("+n.currentPoint+")").addClass("player1-board-peg")}return l.prototype.templates=function(){return{page:r,p1Hand:i,p2Hand:s,p1Score:a,p2Score:a,play:u,deck:o,crib:s,controls:f,scoreControl:"",messages:"{{#$messages}}<li>{{.}}</li>{{/$messages}}"}},l.prototype.init=function(){this.render()},l.prototype.deck=function(){this.render()},l.prototype.selectCard=function(){this.render()},l.prototype.action=function(){this.render()},l.prototype.render=function(){var n=t.render(this.templates().page,this.data,this.templates());e("#content").html(n),this.bindEvents(),this.mediator.publish("render",this.name,this.game),this.mediator.publish("messages-clear"),this.data&&this.data.$player1&&h(this.data)},l.prototype.renderOnly=function(){this.render(),this.unbindEvents()},l.prototype.bindEvents=function(){e("#deck").on("click",function(t){this.unbindEvents();var n=e("#deck ul").children().indexOf(t.target.parentNode);e(t.target).addClass("selected"),this.deck(n)}.bind(this)),e("#bottomHand").on("click",function(t){this.unbindEvents();var n=t.target,r;while(n.nodeName!=="LI")n.nodeName==="A"&&(r=n),n=n.parentNode;var i=[].slice.call(e("#bottomHand").children()).indexOf(n);this.selectCard({index:i,card:r,event:t})}.bind(this)),e("#controls button").on("click",function(){this.unbindEvents(),this.action()}.bind(this)),e("a.home-link").on("click",function(){this.mediator.publish("transition","Home")}.bind(this)),e("a.help-link").on("click",function(){this.mediator.publish("transition","Info")}.bind(this))},l.prototype.unbindEvents=function(){e("#deck").off("click"),e("#bottomHand").off("click"),e("#controls").off("click","button"),e("a.home-link").off("click")},l}),define("gameStates/DrawState",["gameStates/BaseState","text!templates/game.visibleHand.html"],function(e,t){function n(t){e.call(this,t,"Draw")}n.prototype=Object.create(e.prototype),n.prototype.constructor=n;var r=function(){if(this.p1.crib[0].faceValue<this.p2.crib[0].faceValue)return this.p1;if(this.p1.crib[0].faceValue>this.p2.crib[0].faceValue)return this.p2};return n.prototype.init=function(){this.mediator.publish("messages-add","Click the deck to start"),this.render()},n.prototype.templates=function(){var n=e.prototype.templates();return n.crib=t,n},n.prototype.deck=function(){this.game.$deck.shuffle(),this.game.$player1HandVisible=!0,this.game.$player2HandVisible=!0,this.p1.crib=[this.game.$deck.cut()],this.p2.crib=[this.game.$deck.cut()],this.game.$cribOwner=r.call(this),this.game.$cribOwner?(this.mediator.publish("messages-add",this.game.$cribOwner.name+" won"),this.renderOnly(),this.mediator.publish("transition","Deal",!0)):(this.mediator.publish("messages-add","It was a tie, draw again"),this.render()),this.p1.crib=[],this.p2.crib=[]},n}),define("gameStates/DealState",["gameStates/BaseState","modules/DeckModule","text!templates/game.visibleHand.html"],function(e,t,n){function r(n){e.call(this,n,"Deal"),this.game.$deck=new t}function i(e,t){return e.faceValue-t.faceValue}return r.prototype=Object.create(e.prototype),r.prototype.constructor=r,r.prototype.templates=function(){var t=e.prototype.templates();return t.p2Hand=n,t},r.prototype.init=function(){this.game.$action={text:"..."},this.mediator.publish("messages-add","Dealing cards"),this.renderOnly(),this.game.$player2HandVisible=!1,this.game.$deck.shuffle();var e=this.game.$deck.deal();this.p1.hand=e.bottomHand.sort(i),this.p2.hand=e.topHand.sort(i),this.mediator.publish("transition","Crib",!0)},r}),define("gameStates/CribState",["gameStates/BaseState"],function(e){function t(t){e.call(this,t,"Crib")}return t.prototype=Object.create(e.prototype),t.prototype.constructor=t,t.prototype.init=function(){this.game.$action={text:"Pick"},this.mediator.publish("messages-add","Pick two cards for "+this.game.$cribOwner.possessive+" crib"),this.p2.hand.length===6&&(this.p2.placeCardsInCrib(this.game.$cribOwner),this.p2.handInMemory=this.p2.hand.slice()),this.render()},t.prototype.selectCard=function(e){var t=this.p1.selectCribCard(e.index);t.length===2?(this.mediator.publish("messages-add","When you're ready, continue"),this.game.$action={text:"Cont."}):t.length===1?this.mediator.publish("messages-add","Pick one more card"):this.mediator.publish("messages-add","Pick two cards for "+this.game.$cribOwner.possessive+" crib"),this.render()},t.prototype.action=function(){this.p1.getSelectedCards().length===2?(this.p1.placeCardsInCrib(this.game.$cribOwner),this.p1.handInMemory=this.p1.hand.slice(),this.mediator.publish("transition","PrePlay")):(this.mediator.publish("messages-add","Pick two cards for "+this.game.$cribOwner.possessive+" crib"),this.render())},t}),define("text!templates/game.hiddenStraitDeck.html",[],function(){return'<ul class="deck strait">\n  {{#$deck.cards}}\n  <li><a class="card back">*</a></li>\n  {{/$deck.cards}}\n</ul>\n'}),define("text!templates/game.visibleDeck.html",[],function(){return'<ul class="deck">\n  {{#topCard}}\n  <li class="card back">*</li>\n  <li class="card back">*</li>\n  <li class="card back">*</li>\n  <li class="card back">*</li>\n  <li class="card back">*</li>\n  <li class="card back">*</li>\n  <li class="card rank-{{name}} {{suit}}">\n    <span class="rank">{{name}}</span>\n    <span class="suit">&{{suit}};</span>\n  </li>\n  {{/topCard}}\n</ul>\n'}),define("gameStates/PrePlayState",["gameStates/BaseState","text!templates/game.hiddenStraitDeck.html","text!templates/game.visibleDeck.html"],function(e,t,n){function r(t){e.call(this,t,"PrePlay")}function i(e,t){var n=this.game.$cribOwner===this.game.$player1?this.game.$player2:this.game.$player1,r=n.selectOneFromDeck(this.game.$deck,e);this.game.topCard=r,n.isWinner()?this.mediator.publish("transition","Summary"):(this.game.$showTopCard=!0,t&&this.render(),this.mediator.publish("transition","Play",!0))}return r.prototype=Object.create(e.prototype),r.prototype.constructor=r,r.prototype.templates=function(){var r=e.prototype.templates();return this.game.$showTopCard?r.deck=n:r.deck=t,r},r.prototype.init=function(){this.game.$action={text:"..."};if(this.game.$cribOwner!==this.game.$player1)this.mediator.publish("messages-add","Cut the deck"),this.render();else{this.mediator.publish("messages-add","They will cut the deck");var e=Math.floor(Math.random()*this.game.$deck.cards.length);this.render(),i.call(this,e,!1)}},r.prototype.deck=function(e){i.call(this,e,!0)},r}),define("modules/StorageModule",[],function(){function e(e){return localStorage.getItem(e)}function t(e,t){return localStorage.setItem(e,t)}function n(e){return{name:e.$player1.name,possessive:e.$player1.possessive,hand:e.$player1.hand,handInMemory:e.$player1.handInMemory,crib:e.$player1.crib,points:e.$player1.points,currentPoints:e.$player1.currentPoints}}function r(e){return{name:e.$player2.name,possessive:e.$player2.possessive,hand:e.$player2.hand,handInMemory:e.$player2.handInMemory,crib:e.$player2.crib,points:e.$player2.points,currentPoints:e.$player2.currentPoints}}function i(e){if(e.$cribOwner)return e.$cribOwner.name}function s(e){return{currentBoardValue:e.$board.currentBoardValue,totalPlayedCardsForRound:e.$board.totalPlayedCardsForRound,playedCards:e.$board.playedCards,playersWhoSaidGo:e.$board.playersWhoSaidGo}}return{loadSettings:function(){return JSON.parse(e("settings"))},saveSettings:function(e){t("settings",JSON.stringify(e))},loadGame:function(){return{game:JSON.parse(e("game")),state:e("state")}},saveGame:function(e,o){t("game",JSON.stringify({$deck:e.$deck,$player1:n(e),$player2:r(e),$cribOwner:i(e),$player1HandVisible:e.$player1HandVisible,$player2HandVisible:e.$player2HandVisible,countStateStep:e.countStateStep,topCard:e.topCard,showTopCard:e.$showTopCard,$board:s(e),$messages:e.$messages,$action:e.$action})),t("state",o)}}}),define("modules/SettingsModule",["modules/StorageModule"],function(e){var t;return{_defaultSettings:[{id:"action-confirmation",name:"Confirm Selection",description:"an additional step to confirm the selected card",value:!1},{id:"manual-count",name:"Count Manually",description:"Player scores their own points",value:!1}],get:function(e){return t||this.load(),t.filter(function(t){return t.id===e})[0].value},load:function(){return t=e.loadSettings(),t||(t=this._defaultSettings),t},save:function(n){t=n,e.saveSettings(n)}}}),define("text!templates/game.scoreControl.html",[],function(){return'<div id="scoreControl">\n  <input type="range" min="0" max="{{maxPoints}}" value="{{selectedScore}}" step="1" list="scoreScale">\n  <span>{{selectedScore}}</span>\n\n  <datalist id="scoreScale">\n    {{#availablePoints}}\n      <option>{{.}}</option>\n    {{/availablePoints}}\n  </datalist>\n</div>\n'}),define("gameStates/PlayState",["jquery","gameStates/BaseState","modules/SettingsModule","text!templates/game.visibleDeck.html","text!templates/game.scoreControl.html"],function(e,t,n,r,i){function s(e){t.call(this,e,"Play"),this.nextState="Play",this.isScorePoints=!1,this.p1.maxPoints=15,this.p1.availablePoints=o(this.p1.maxPoints)}function o(e){var t=0,n=[];while(t<e)t++,n.push(t);return n}function u(){this.p1.isWinner()?this.mediator.publish("transition","Summary",!0):d.call(this)?this.mediator.publish("transition","Play",!1):(this.renderOnly(),this.nextState="Play",this.mediator.publish("transition","Play",!0))}function a(e){this.p1.selectedScore=0,this.isScorePoints=!0,this.p1.placeCardOnTable(e),this.render()}function f(e){this.isScorePoints=!1,this.p1.playCard(e),l.call(this),u.call(this)}function l(){this.game.currentPlayer=this.p2,d.call(this)||(this.mediator.publish("messages-add",this.p2.possessive+" turn"),this.game.$action={text:"..."})}function c(){this.game.currentPlayer||(this.isScorePoints=!1,this.game.$cribOwner===this.p1?this.game.currentPlayer=this.p2:this.game.currentPlayer=this.p1)}function h(){try{this.p2.playCard(),this.game.currentPlayer=this.p1,d.call(this)||(this.mediator.publish("messages-add",this.p1.possessive+" turn"),this.game.$action={text:"..."}),this.p2.isWinner()&&this.mediator.publish("transition","Summary",!0)}catch(e){console.log(e)}}function p(){d.call(this)?(this.mediator.publish("messages-add","Round over!"),this.game.$action={text:"Ok"},this.nextState="Count",this.game.currentPlayer=undefined):this.p1.playRules.hasPlayableCards(this.p1)||(this.game.$action={text:"Go"})}function d(){return this.p1.hand.length===0&&this.p2.hand.length===0}return s.prototype=Object.create(t.prototype),s.prototype.constructor=s,s.prototype.templates=function(){var e=t.prototype.templates();return e.deck=r,this.isScorePoints&&(e.scoreControl=i),e},s.prototype.init=function(){this.game.$action={text:"..."},this.p1.playRules.hasPlayableCards(this.p1)||(this.game.$action={text:"Go"}),d.call(this)||(c.call(this),this.game.currentPlayer===this.p2?h.call(this):this.mediator.publish("messages-add",this.p1.possessive+" turn")),p.call(this),this.render()},s.prototype.selectCard=function(e){try{n.get("action-confirmation")&&this.game.$action.text==="..."?(this.p1.selectCard(e.index),this.mediator.publish("messages-add","Tap OK to continue"),this.game.$action={text:"Ok"},this.render()):n.get("manual-count")&&this.game.$action.text==="..."?(this.p1.selectCard(e.index),this.mediator.publish("messages-add","Tap OK to continue"),this.game.$action={text:"Ok"},a.call(this,e.index)):this.game.$action.text==="..."?f.call(this,e.index):console.log("you shouldn't be here")}catch(t){t.message==="No Playable Cards"?this.mediator.publish("messages-add","No Playable Cards, Press 'Go!'"):t.message==="Invalid Playable Card"&&this.mediator.publish("messages-add","Try another card"),this.mediator.publish("transition","Play",!1)}},s.prototype.action=function(){var e=this.p1.hand.indexOf(this.p1.getSelectedCards()[0]);if(this.nextState==="Count"){this.mediator.publish("board-clear"),this.mediator.publish("transition",this.nextState,!1),this.nextState="Play";return}if(this.isScorePoints){f.call(this);return}if(!this.p1.playRules.hasPlayableCards(this.p1)){this.p1.announceGo(),l.call(this),u.call(this);return}if(n.get("manual-count")&&!this.isScorePoints){a.call(this,e);return}if(e!==-1){f.call(this,e);return}this.mediator.publish("messages-add","You can't go, you have playable cards."),this.render()},s.prototype.bindEvents=function(){t.prototype.bindEvents.call(this),e("#scoreControl input[type=range]").on("input change",function(t){this.p1.selectedScore=t.srcElement.valueAsNumber,e("#scoreControl span").html(t.srcElement.valueAsNumber)}.bind(this))},s}),define("modules/CountScoreKeeper",["modules/BaseScoreKeeper"],function(e){function t(){e.call(this)}function n(e,t,r,i,s,o,u,a){if(i===r){var f=0;for(var l=0;l<r;l++)f+=s[l].value;f===a&&u.push(s.slice(0,s.length));return}if(o>=t)return;s[i]=e[o],n(e,t,r,i+1,s,o+1,u,a),n(e,t,r,i,s,o+1,u,a)}return t.prototype=Object.create(e.prototype),t.prototype.constructor=t,t.prototype.get15s=function(e,t){var r=e.concat(t),i=[],s=[];for(var o=0;o<=r.length;o++)n(r,r.length,o,0,s,0,i,15);return i.length*2},t.prototype.getPairs=function(e,t){var n=[],r=e.concat(t);return r.forEach(function(e,t,r){for(var i=t+1;i<r.length;i++)e.faceValue===r[i].faceValue&&n.push([e,r[i]])}),n.length*2},t.prototype.getRuns=function(e,t){function i(e,t){var n=function(e,t,r,i){if(e===0){r.length>0&&(i[i.length]=r);return}for(var s=0;s<t.length;s++)n(e-1,t.slice(s+1),r.concat([t[s]]),i);return},r=[];for(var i=t;i<e.length;i++)n(i,e,[],r);return r.push(e),r}function s(e,t){return e.faceValue-t.faceValue}function o(e){return e.sort(s),e}function u(e,t,n){return t===n.length-1?!0:e.faceValue+1===n[t+1].faceValue}var n=0,r=e.concat(t),a=i(r,3);a.forEach(o);var f=a.filter(function(e){return e.every(u)}),l=0;f.forEach(function(e){e.length>l&&(l=e.length)});var c=f.filter(function(e){return e.length===l});return c.forEach(function(e){n+=e.length}),n},t.prototype.getHandFlush=function(e,t){function n(e,t,n){return e.suit===n[0].suit}var r=e.slice(0,e.length);return r.push(t),r.every(n)?5:e.every(n)?4:0},t.prototype.getNobs=function(e,t){var n=e.some(function(e){return e.faceValue===11&&e.suit===t.suit});return n?1:0},t.prototype.evaluateHand=function(e,t){var n=0,r=0,i="";n+=this.get15s(e.hand,t),n+=this.getPairs(e.hand,t),n+=this.getRuns(e.hand,t),n+=this.getHandFlush(e.hand,t),n+=this.getNobs(e.hand,t),e.selectedScore&&(r=e.selectedScore-n,r>0?(this.mediator.publish("messages-add",e.name+" said "+e.selectedScore+" points"),this.mediator.publish("messages-add","the actual points were "+n),n=n-r>=0?n-r:0,i=" (-"+r+")"):(this.mediator.publish("messages-add",e.name+" found "+e.selectedScore+" of the total "+n+" points"),i=" (-"+(n-e.selectedScore)+")",n=e.selectedScore)),n!==0&&(e.currentPoints=e.points),e.points+=n,this.mediator.publish("messages-add",e.name+" scored "+n+" points"+i)},t}),define("gameStates/CountState",["jquery","gameStates/BaseState","modules/CountScoreKeeper","modules/SettingsModule","text!templates/game.visibleHand.html","text!templates/game.visibleDeck.html","text!templates/game.scoreControl.html"],function(e,t,n,r,i,s,o){function u(e){t.call(this,e,"Count"),e.countStateStep=e.countStateStep||0,this.p1.maxPoints=29,this.p1.availablePoints=a(this.p1.maxPoints),this.scoreKeeper=new n}function a(e){var t=0,n=[];while(t<e)t++,n.push(t);return n}function f(){var e=0;this.game.countStateStep===0?l.call(this,e):this.game.countStateStep===1?c.call(this,e):this.game.countStateStep===2?h.call(this):p.call(this)}function l(e){m.call(this)?v.call(this,e):d.call(this,e),this.game.countStateStep+=1,this.render()}function c(e){m.call(this)?(d.call(this,e),this.p2.hand=[]):(v.call(this,e),this.p1.hand=[]),this.game.countStateStep+=1,this.render()}function h(){this.game.$cribOwner.hand=this.game.$cribOwner.crib.length===4?this.game.$cribOwner.crib:this.game.$cribOwner.hand,this.game.$cribOwner.crib=[],m.call(this)?d.call(this):v.call(this),this.game.countStateStep+=1,this.render()}function p(){m.call(this)?this.game.$cribOwner=this.p2:this.game.$cribOwner=this.p1,g.call(this),this.game.$showTopCard=!1,this.game.countStateStep=0,this.render(),this.p1.isWinner()||this.p2.isWinner()?this.mediator.publish("transition","Summary",!0):this.mediator.publish("transition","Deal")}function d(e){return g.call(this),this.isScorePoints||(this.scoreKeeper.evaluateHand(this.p1,this.game.topCard),this.p1.isWinner()&&this.mediator.publish("transition","Summary",!0)),e}function v(e){return y.call(this),this.scoreKeeper.evaluateHand(this.p2,this.game.topCard),this.p2.isWinner()&&this.mediator.publish("transition","Summary",!0),e}function m(){return this.game.$cribOwner===this.p1}function g(){this.game.$player2HandVisible=!1,this.game.$player1HandVisible=!0,r.get("manual-count")&&(this.isScorePoints=this.isScorePoints?!1:!0,this.isScorePoints&&(this.p1.selectedScore=0))}function y(){this.game.$player2HandVisible=!0,this.game.$player1HandVisible=!1}return u.prototype=Object.create(t.prototype),u.prototype.constructor=u,u.prototype.templates=function(){var e=t.prototype.templates();return e.deck=s,e.p2Hand=i,this.isScorePoints&&(e.scoreControl=o),e},u.prototype.init=function(){this.isScorePoints=!1,this.p1.restoreHand(),this.p2.restoreHand(),this.game.countStateStep===0?f.call(this):this.render()},u.prototype.action=function(){this.isScorePoints&&this.game.countStateStep--,f.call(this)},u.prototype.bindEvents=function(){t.prototype.bindEvents.call(this),e("#scoreControl input[type=range]").on("input change",function(t){this.p1.selectedScore=t.srcElement.valueAsNumber,e("#scoreControl span").html(t.srcElement.valueAsNumber)}.bind(this))},u}),define("text!templates/summary.html",[],function(){return'<h1>{{winner.name}} Won!</h1>\n<h3>{{$player1.possessive}} points:</h3>\n<h4>{{$player1.points}}</h4>\n<h3>{{$player2.possessive}} points:</h3>\n<h4>{{$player2.points}}</h4>\n\n<div id="bottomControls">\n  <button id="newGameButton">Play again?</button>\n  <button id="homeButton">Home</button>\n</div>\n'}),define("gameStates/SummaryState",["jquery","gameStates/BaseState","text!templates/summary.html"],function(e,t,n){function r(e){t.call(this,e,"Summary")}return r.prototype=Object.create(t.prototype),r.prototype.constructor=r,r.prototype.templates=function(){var e=t.prototype.templates();return e.page=n,e},r.prototype.bindEvents=function(){e("#newGameButton").on("click",function(){this.mediator.publish("start")}.bind(this)),e("#homeButton").on("click",function(){this.mediator.publish("transition","Home")}.bind(this))},r}),define("text!templates/home.html",[],function(){return'<header>\n  <h1>Cribbage</h1>\n  <h4>The Game</h4>\n</header>\n<a class="link settings-link"><i class="fa fa-gear"></i></a>\n<div id="homeDeck">\n  <div class="playingCards rotateHand">\n    <ul class="hand">\n      {{#.}}{{> p1Hand}}{{/.}}\n    </ul>\n  </div>\n</div>\n<div id="bottomControls">\n  {{> continue}}\n  <button id="newGameButton">New Game</button>\n</div>\n'}),define("gameStates/HomeState",["jquery","gameStates/BaseState","modules/DeckModule","text!templates/home.html"],function(e,t,n,r){function i(e){t.call(this,e,"Home"),this.data=(new n).shuffle().cards.splice(0,6)}return i.prototype=Object.create(t.prototype),i.prototype.constructor=i,i.prototype.templates=function(){var e=t.prototype.templates();return e.page=r,e.continue=this.game?'<button id="continueGameButton">Continue Game</button>':"",e},i.prototype.bindEvents=function(){e("#newGameButton").on("click",function(){this.mediator.publish("start")}.bind(this)),e("#continueGameButton").on("click",function(){this.mediator.publish("continue")}.bind(this)),e("a.settings-link").on("click",function(){this.mediator.publish("transition","Settings")}.bind(this))},i}),define("text!templates/info.html",[],function(){return'<a class="link back-link"><i class="fa fa-chevron-left"></i></a>\n<div id="titleBar">\n  <h1>Info</h1>\n</div>\n<div class="paragraph-container">\n  <h2><i class="fa fa-list-ol"></i> <a href="http://en.wikipedia.org/wiki/Rules_of_cribbage">Cribbage Rules</a></h2>\n\n  <p>Don\'t know how to play? check out these rules to learn more about Cribbage.</p>\n\n  <h2><i class="fa fa-wrench"></i> <a href="https://github.com/lpaulger/cribbage-the-game/issues">Report bugs</a></h2>\n\n  <p>If something doesn\'t seem to be working correctly, or you\'d like to see improvements then please head over to log\n    an issue.</p>\n\n  <h2><i class="fa fa-at"></i> <a href="http://lucaspaulger.com/">About Me</a></h2>\n\n  <p>Checkout my <a href="http://lucaspaulger.com/">website</a>, or contact me at <a\n    href="mailto:lucas.paulger@gmail.com">lucas.paulger@gmail.com</a> to learn more.</p>\n\n\n  <span>Made with <i class="fa fa-heart"></i> in Europe</span>\n</div>\n'}),define("gameStates/InfoState",["jquery","gameStates/BaseState","text!templates/info.html"],function(e,t,n){function r(e){t.call(this,e,"Info")}return r.prototype=Object.create(t.prototype),r.prototype.constructor=r,r.prototype.templates=function(){var e=t.prototype.templates();return e.page=n,e},r.prototype.bindEvents=function(){t.prototype.bindEvents.call(this),e("a.back-link").on("click",function(){this.mediator.publish("transition","Back")}.bind(this))},r}),define("text!templates/settings.html",[],function(){return'<a class="link back-link"><i class="fa fa-chevron-left"></i></a>\n<div id="titleBar">\n  <h1>Settings</h1>\n</div>\n\n<ul id="settingsList">\n  {{#settings}}\n  <li>\n    <h4>{{name}}</h4>\n    <p>{{description}}</p>\n    <span data-id="{{id}}">\n      {{#value}}\n      <i class="fa fa-toggle-on"></i>\n      {{/value}}\n      {{^value}}\n      <i class="fa fa-toggle-off"></i>\n      {{/value}}\n    </span>\n  </li>\n  {{/settings}}\n</ul>\n'}),define("gameStates/SettingsState",["jquery","gameStates/BaseState","modules/DeckModule","modules/SettingsModule","text!templates/settings.html"],function(e,t,n,r,i){function s(e){t.call(this,e,"Settings")}return s.prototype=Object.create(t.prototype),s.prototype.constructor=s,s.prototype.init=function(){this.data={settings:r.load()},this.render()},s.prototype.templates=function(){var e=t.prototype.templates();return e.page=i,e},s.prototype.bindEvents=function(){t.prototype.bindEvents.call(this),e("a.back-link").on("click",function(){this.mediator.publish("transition","Home")}.bind(this)),e("#settingsList li span").on("click",function(t){var n=t.currentTarget,i=n.attributes["data-id"].value,s=this.data.settings.filter(function(e){return e.id===i})[0];s.value=!s.value,e(n).children().toggleClass("fa-toggle-off").toggleClass("fa-toggle-on"),r.save(this.data.settings)}.bind(this))},s}),define("gameStates/StateRegistry",["gameStates/DrawState","gameStates/DealState","gameStates/CribState","gameStates/PrePlayState","gameStates/PlayState","gameStates/CountState","gameStates/SummaryState","gameStates/HomeState","gameStates/InfoState","gameStates/SettingsState"],function(DrawState,DealState,CribState,PrePlayState,PlayState,CountState,SummaryState,HomeState,InfoState,SettingsState){function StateManager(){this.states=[]}return StateManager.prototype.initState=function(stateName,game){var state;state=this.states.filter(function(e){return e.name===stateName})[0];if(!state){try{state=eval("new "+stateName+"State(game)")}catch(e){throw new Error(stateName+"State Not Found")}this.states.push(state)}return state},StateManager}),define("modules/Mediator",["modules/PubSub","modules/GameModule","gameStates/StateRegistry","modules/StorageModule"],function(e,t,n,r){function i(){e.installTo(this),e.subscribe("App:Start",this.appInit),e.subscribe("start",this.startGame),e.subscribe("continue",this.continueGame),e.subscribe("transition",this.transitionTo),e.subscribe("messages-add",this.setMessages),e.subscribe("messages-clear",this.clearMessages),e.subscribe("winner",this.setWinner),e.subscribe("board-clear",this.clearBoard),e.subscribe("render",this.saveGame)}return i.prototype.appInit=function(){this.stateRegistry=new n;var i=r.loadGame();i.game?(this.game=new t(i.game),e.publish("transition",i.state)):e.publish("transition","Home")},i.prototype.startGame=function(){this.game=new t({}),this.game.$board.clearBoard(),this.stateRegistry=new n,e.publish("transition","Draw")},i.prototype.continueGame=function(){var i=r.loadGame();this.game=new t(i.game),this.stateRegistry=new n,e.publish("transition",i.state)},i.prototype.transitionTo=function(e,t){function i(){n=this.stateRegistry.initState(e,this.game),n.init()}var n;e==="Back"&&(e=r.loadGame().state||"Home"),t?setTimeout(i.bind(this),1e3):i.call(this)},i.prototype.setMessages=function(e){function t(e){return e.charAt(0).toUpperCase()+e.substr(1)}e=t(e),this.game.$messages.indexOf(e)===-1&&this.game.$messages.push(e)},i.prototype.clearMessages=function(){this.game&&(this.game.$messages=[])},i.prototype.setWinner=function(e){this.game.winner=e},i.prototype.clearBoard=function(){this.game.$board.clearBoard()},i.prototype.saveGame=function(e,t){e!=="Home"&&e!=="Info"&&e!=="Settings"&&r.saveGame(t,e)},i}),define("app",["modules/Mediator"],function(e){function t(){this.mediator=new e}return t.prototype.init=function(){this.mediator.publish("App:Start")},t}),require(["app"],function(e){var t=new e;t.init()}),define("main",function(){});